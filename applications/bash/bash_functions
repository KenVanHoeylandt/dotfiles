function parse_git_branch {
    git rev-parse --git-dir > /dev/null 2>&1
    if [ $? -eq 0 ]; then
        state=""
        git_status="$(git status 2> /dev/null)"
        detached_branch_pattern="# Not currently on any branch"
        untracked_pattern="# Untracked files:"
        new_pattern="new file:"
        not_staged_pattern="Changes not staged for commit"

        if [ $(type -t __git_ps1) ]; then
            echo -e " ($(__git_ps1 '%s'))"
        fi
    fi
    return
}